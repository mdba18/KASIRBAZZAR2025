<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Order Menu</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f9f9ff, #e0f0ff);
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: #333;
      overflow-x: hidden;
    }

    .container {
      width: 95%;
      max-width: 1000px;
      padding: 30px;
      background: rgba(255,255,255,0.95);
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-bottom: 30px;
    }

    .menu-card {
      background: linear-gradient(145deg, #ffffff, #f2f7ff);
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      transition: transform .3s ease, box-shadow .3s ease;
      position: relative;
    }
    .menu-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 28px rgba(0,0,0,0.15);
    }

    .menu-card::before {
      content: "üçΩÔ∏è";
      font-size: 24px;
      position: absolute;
      top: 10px;
      right: 14px;
      opacity: 0.3;
    }

    .menu-card .label {
      font-weight: 700;
      margin-bottom: 14px;
      font-size: 18px;
      color: #222;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
    }

    .controls button {
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      background: #6a5af9;
      border: none;
      color: white;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(106,90,249,0.4);
      transition: transform 0.2s, background 0.3s;
    }
    .controls button:hover {
      transform: scale(1.1);
      background: #5144d1;
    }

    .controls input {
      width: 55px;
      height: 40px;
      text-align: center;
      border: none;
      font-size: 16px;
      font-weight: bold;
      color: #333;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
    }

    .summary {
      margin-top: 24px;
      font-size: 15px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px 28px;
      align-items: center;
    }

    .summary .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .summary .row div {
      font-weight: 600;
      color: #444;
    }

    .summary input[type="text"], .summary input[type="number"] {
      text-align: right;
      padding: 10px 12px;
      border: 1px solid #d0d0d0;
      border-radius: 12px;
      width: 180px;
      background: #fdfdfd;
      font-size: 14px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.06);
    }

    .kupon-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .order-btn {
      display: block;
      margin: 30px auto 0;
      padding: 14px 50px;
      background: linear-gradient(135deg, #6a5af9, #43e97b);
      color: #fff;
      font-weight: bold;
      border: none;
      font-size: 18px;
      cursor: pointer;
      border-radius: 40px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      transition: transform .2s ease, box-shadow .2s ease;
    }

    .order-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }

    @media (max-width:820px){
      .summary input{width:140px;}
    }
    @media (max-width:420px){
      .summary{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="orderForm" onsubmit="return submitForm()">
      <div class="menu-grid">
        <div class="menu-card"><span class="label">SHILIN</span>
          <div class="controls"><button type="button" onclick="decrementValue('shilin')">-</button>
          <input id="shilin" name="shilin" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('shilin')">+</button></div>
        </div>

        <div class="menu-card"><span class="label">KENTANG</span>
          <div class="controls"><button type="button" onclick="decrementValue('kentang')">-</button>
          <input id="kentang" name="kentang" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('kentang')">+</button></div>
        </div>

        <div class="menu-card"><span class="label">SHILIN + KENTANG</span>
          <div class="controls"><button type="button" onclick="decrementValue('paket_shilin_kentang')">-</button>
          <input id="paket_shilin_kentang" name="paket_shilin_kentang" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('paket_shilin_kentang')">+</button></div>
        </div>

        <div class="menu-card"><span class="label">COOKIES</span>
          <div class="controls"><button type="button" onclick="decrementValue('cookies')">-</button>
          <input id="cookies" name="cookies" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('cookies')">+</button></div>
        </div>

        <div class="menu-card"><span class="label">MIE</span>
          <div class="controls"><button type="button" onclick="decrementValue('mie')">-</button>
          <input id="mie" name="mie" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('mie')">+</button></div>
          <div id="mie-levels" style="margin-top:8px; text-align:left;"></div>
        </div>

        <div class="menu-card"><span class="label">POP ICE</span>
          <div class="controls"><button type="button" onclick="decrementValue('popice')">-</button>
          <input id="popice" name="popice" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('popice')">+</button></div>
          <div id="popice-variants" style="margin-top:8px; text-align:left;"></div>
        </div>

        <div class="menu-card"><span class="label">ROTI BAKAR</span>
          <div class="controls"><button type="button" onclick="decrementValue('rotibakar')">-</button>
          <input id="rotibakar" name="rotibakar" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('rotibakar')">+</button></div>
        </div>

        <div class="menu-card"><span class="label">MOJITO</span>
          <div class="controls"><button type="button" onclick="decrementValue('mojito')">-</button>
          <input id="mojito" name="mojito" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('mojito')">+</button></div>
        </div>
      </div>

      <div class="summary">
        <div class="row"><div>Nama :</div><input type="text" id="nama_pembeli" name="nama_pembeli" required /></div>
        <div class="row"><div>Total :</div><input type="text" id="total-bayar" name="total_bayar" value="Rp0" readonly /></div>
        <div class="row"><div>Tunai :</div><input type="text" id="tunai" name="tunai" inputmode="numeric" autocomplete="off" /></div>
        <div class="row"><div>Kupon :</div>
          <div class="kupon-controls"><button type="button" onclick="decrementValue('kupon')">-</button>
          <input id="kupon" name="kupon" type="number" value="0" readonly />
          <button type="button" onclick="incrementValue('kupon')">+</button></div>
        </div>
        <div class="row"><div>Nominal Kupon :</div><input type="text" id="kupon-value" value="Rp0" readonly /></div>
        <div class="row"><div>Keterangan :</div><input type="text" id="keterangan" name="keterangan" readonly /></div>
      </div>

      <button type="submit" class="order-btn">ORDER</button>
    </form>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAqgN6OK7Io9SVMaapa4M1V00i9tZywIis",
  authDomain: "bazzar-2025.firebaseapp.com",
  databaseURL: "https://bazzar-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "bazzar-2025",
  storageBucket: "bazzar-2025.firebasestorage.app",
  messagingSenderId: "905026481557",
  appId: "1:905026481557:web:6dcfa193e73f8ca0885a9c",
  measurementId: "G-RNYN5J8Z64"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// simpan supaya bisa dipanggil di fungsi submitForm()
window._firebaseDB = db;
window._firebaseRef = ref;
window._firebasePush = push;
</script>

<script>
let tunaiRaw = '';

function incrementValue(id){const el=document.getElementById(id);el.value=parseInt(el.value||0)+1;calculateTotal();if(id==='popice')updatePopiceVariants();if(id==='mie')updateMieLevels();}
function decrementValue(id){const el=document.getElementById(id);const val=parseInt(el.value||0);if(val>0){el.value=val-1;calculateTotal();if(id==='popice')updatePopiceVariants();if(id==='mie')updateMieLevels();}}

function calculateTotal(){const prices={shilin:15000,kentang:10000,paket_shilin_kentang:23000,cookies:8000,mie:7000,popice:5000,rotibakar:10000,mojito:12000};let total=0;for(let k in prices){const input=document.getElementById(k);total+=(parseInt(input.value||0)*prices[k]);}document.getElementById('total-bayar').value="Rp"+total.toLocaleString('id-ID');calculateChange();}

function updatePopiceVariants(){
  const qty=parseInt(document.getElementById('popice').value||0,10);
  const c=document.getElementById('popice-variants');
  c.innerHTML='';
  const flavors=["Vanilla Blue","Permen Karet","Cokelat","Taro","Stroberi"];
  for(let i=1;i<=qty;i++){
    const l=document.createElement('label');
    l.textContent='Varian Pop Ice '+i+': ';
    l.style.fontWeight='bold';l.style.display='block';l.style.marginTop='6px';
    const s=document.createElement('select');
    s.name='popice_variant_'+i;
    s.style.width='100%';
    flavors.forEach(v=>{
      const o=document.createElement('option');
      o.value=v;
      o.textContent=v;
      s.appendChild(o);
    });
    c.appendChild(l);
    c.appendChild(s);
  }
}

function updateMieLevels(){
  const qty=parseInt(document.getElementById('mie').value||0,10);
  const c=document.getElementById('mie-levels');
  c.innerHTML='';
  const levels=["Level 0","Level 1","Level 2","Level 3","Level 4"];
  for(let i=1;i<=qty;i++){
    const l=document.createElement('label');
    l.textContent='Level Mie '+i+': ';
    l.style.fontWeight='bold';l.style.display='block';l.style.marginTop='6px';
    const s=document.createElement('select');
    s.name='mie_level_'+i;
    s.style.width='100%';
    levels.forEach(v=>{
      const o=document.createElement('option');
      o.value=v;
      o.textContent=v;
      s.appendChild(o);
    });
    c.appendChild(l);
    c.appendChild(s);
  }
}

function updateTunaiDisplay(){const input=document.getElementById('tunai');if(!tunaiRaw){input.value='';}else{const n=parseInt(tunaiRaw,10)*1000;input.value='Rp'+n.toLocaleString('id-ID');}setTimeout(()=>setCaretToEnd(input),0);}
function setCaretToEnd(el){try{const len=el.value.length;el.setSelectionRange(len,len);el.focus();}catch(e){}}
function initTunaiInput(){const el=document.getElementById('tunai');el.addEventListener('keydown',function(e){if(e.key==='Tab'||e.key==='Enter'||e.key.startsWith('Arrow'))return;if(e.ctrlKey||e.metaKey||e.altKey)return;if(e.key==='Backspace'){e.preventDefault();tunaiRaw=tunaiRaw.slice(0,-1);updateTunaiDisplay();calculateChange();return;}if(e.key==='Delete'){e.preventDefault();tunaiRaw='';updateTunaiDisplay();calculateChange();return;}if(/^[0-9]$/.test(e.key)){e.preventDefault();if(tunaiRaw==='0')tunaiRaw='';tunaiRaw+=e.key;updateTunaiDisplay();calculateChange();return;}e.preventDefault();});}

function calculateChange(){const total=parseInt(document.getElementById('total-bayar').value.replace(/\D/g,''),10)||0;const tunai=tunaiRaw?(parseInt(tunaiRaw,10)*1000):0;const kuponCount=parseInt(document.getElementById('kupon').value||0,10)||0;const kuponValue=kuponCount*5000;document.getElementById('kupon-value').value="Rp"+kuponValue.toLocaleString('id-ID');const s=(tunai+kuponValue)-total;const ket=document.getElementById('keterangan');if(s<0){ket.value="Kurang Bayar Rp"+Math.abs(s).toLocaleString('id-ID');ket.style.color='red';}else{ket.value="Kembalian Rp"+s.toLocaleString('id-ID');ket.style.color='green';}}

function submitForm(){
  const form=document.getElementById("orderForm");
  const formData=new FormData(form);

  const popiceQty=parseInt(document.getElementById("popice").value||0,10);
  for(let i=1;i<=popiceQty;i++){
    const s=document.querySelector(`[name="popice_variant_${i}"]`);
    if(s) formData.append("popice_variant_"+i,s.value);
  }

  const mieQty=parseInt(document.getElementById("mie").value||0,10);
  for(let i=1;i<=mieQty;i++){
    const s=document.querySelector(`[name="mie_level_${i}"]`);
    if(s) formData.append("mie_level_"+i,s.value);
  }

  const tunaiFinal=tunaiRaw?(parseInt(tunaiRaw,10)*1000):0;
  formData.append("tunai_final",tunaiFinal);

  const orderObj = {};
formData.forEach((val,key)=>{ orderObj[key]=val; });
try {
  window._firebasePush(window._firebaseRef(window._firebaseDB,"orders"), orderObj);
} catch(e){ console.error("Firebase error", e); }

  const scriptURL="https://script.google.com/macros/s/AKfycbxnQZw3cy1wnj-ifAqnzRZcOPFxtUwe-cYpYrotpB8BMl3zjE_ImrZoncRNrN8yzQK5/exec";
  fetch(scriptURL,{method:"POST",body:formData})
  .then(r=>r.text())
  .then(txt=>{
    alert("Pesanan berhasil dikirim!");
    form.reset();
    tunaiRaw="";
    document.getElementById("total-bayar").value="Rp0";
    document.getElementById("kupon").value=0;
    document.getElementById("kupon-value").value="Rp0";
    document.getElementById("keterangan").value="";
    document.getElementById("popice-variants").innerHTML="";
    document.getElementById("mie-levels").innerHTML="";
    calculateTotal();
  })
  .catch(err=>{alert("Gagal mengirim pesanan!");console.error(err);});

  return false;
}
document.addEventListener('DOMContentLoaded',function(){initTunaiInput();calculateTotal();});
</script>
</body>
</html>
